resrart<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sea Catch Scorer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background: url('https://i.postimg.cc/pLFtxQWs/seacatchscorecard.jpg') no-repeat center/cover fixed; color: #fff; min-height: 100vh; }
        .container { background: rgba(0, 0, 0, 0.7); border-radius: 15px; padding: 20px; margin: 20px auto; max-width: 800px; z-index: 1; }
        .page { display: none; }
        .splash-screen { display: flex; flex-direction: column; justify-content: flex-end; align-items: center; padding: 40px; height: 100vh; width: 100%; position: fixed; top: 0; left: 0; z-index: 2; }
        .card-section { background: rgba(255, 255, 255, 0.9); border-radius: 15px; padding: 20px; margin: 20px 0; border: 2px solid #007bff; color: #1a1a1a; z-index: 3; }
        .btn { padding: 12px 24px; font-size: 1.1rem; border-radius: 25px; border: none; margin: 10px; transition: transform 0.2s; }
        .btn-primary { background-color: #007bff; color: white; } .btn-primary:hover { background-color: #0056b3; transform: scale(1.05); }
        .btn-secondary { background-color: #6c757d; color: white;} .btn-secondary:hover { background-color: #5a6268; transform: scale(1.05); }
        .btn-danger { background-color: #dc3545; color: white;} .btn-danger:hover { background-color: #c82333; transform: scale(1.05); }
        .btn-outline-secondary { border-color: #6c757d; color: #6c757d; } .btn-outline-secondary:hover { background-color: #6c757d; color: white; }
        h2, h5 { font-weight: 700; margin-bottom: 20px; } h2 { font-size: 2rem; } h5 { font-size: 1.5rem; }
        .form-label { font-weight: 600; color: #333; } .form-control, .form-select { border-radius: 10px; margin-bottom: 15px; }
        .table { background: white; border-radius: 10px; color: #1a1a1a; }
        .modal { z-index: 1050; } .modal-backdrop { z-index: 1040; }
        .modal-content { background: rgba(255, 255, 255, 0.95); border-radius: 15px; border: none; color: #1a1a1a; }
        .scorecard-item { cursor: pointer; padding: 10px; border-bottom: 1px solid #ddd; } .scorecard-item:hover { background-color: #e9ecef; }
        .scorecard-details { display: none; padding: 10px; } .btn-sm { padding: 5px 10px; font-size: 0.9rem; }
        .latest-scorecard { border: 2px solid #0dcaf0; padding: 10px; margin-bottom: 15px !important; border-radius: 8px; background-clip: padding-box; }
        .latest-scorecard .scorecard-item { font-weight: 600; border-bottom: none; }
        .scorecard-details { padding: 15px; background-color: #f8f9fa; border-top: 1px solid #dee2e6; margin-top: 10px; border-radius: 0 0 8px 8px; }
        .scorecard-details h6 { font-weight: 700; margin-top: 15px; margin-bottom: 8px; color: #0056b3; border-bottom: 1px solid #eee; padding-bottom: 4px; }
        .scorecard-details p { margin-bottom: 5px; }
        .scorecard-details hr { margin-top: 15px; margin-bottom: 15px; }
        .scorecard-details .table { margin-bottom: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Splash Screen -->
        <div id="splashScreen" class="splash-screen page">
            <button class="btn btn-primary" id="continueBtn">Start Fishing</button> <!-- Text Changed Here -->
            <button class="btn btn-secondary" id="viewScorecardsBtn">View Saved Scorecards</button>
        </div>

        <!-- Restore Session Modal -->
        <div class="modal fade" id="restoreSessionModal" tabindex="-1" aria-labelledby="restoreSessionModalLabel" aria-hidden="true"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <h5 class="modal-title" id="restoreSessionModalLabel">Restore Previous Session?</h5> <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> </div> <div class="modal-body"> An unsaved session was found. Would you like to restore it? <p><strong>Angler:</strong> <span id="restoreAngler"></span></p> <p><strong>Date:</strong> <span id="restoreDate"></span></p> <p><strong>Fish Caught:</strong> <span id="restoreFishCount"></span></p> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" id="startNewSessionBtn">Start New Session</button> <button type="button" class="btn btn-primary" id="restoreSessionBtn">Restore Session</button> </div> </div> </div> </div>

        <!-- Saved Scorecards Modal -->
        <div class="modal fade" id="savedScorecardsModal" tabindex="-1" aria-labelledby="savedScorecardsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header"> <h5 class="modal-title" id="savedScorecardsModalLabel">Saved Scorecards</h5> <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> </div>
                    <div class="modal-body">
                        <div id="savedScorecardsList" class="card-section" style="padding: 10px;"> </div>
                        <div id="olderScorecardsToggleContainer" class="text-center mt-3"></div>
                    </div>
                    <div class="modal-footer"> <button type="button" class="btn btn-secondary" id="closeModalBtn">Close</button> </div>
                </div>
            </div>
        </div>

        <!-- Registration Page -->
        <div id="registrationPage" class="card-section page"> <h2>Angler Registration</h2> <div class="mb-3"> <label for="anglerName" class="form-label">Angler Name</label> <input type="text" id="anglerName" class="form-control" placeholder="Enter your name"> </div> <div class="mb-3"> <label for="competitionDate" class="form-label">Date</label> <input type="date" id="competitionDate" class="form-control"> </div> <div class="mb-3"> <label for="venueInput" class="form-label">Venue</label> <input type="text" id="venueInput" class="form-control" placeholder="Enter venue"> </div> <div class="mb-3 form-check"> <input type="checkbox" class="form-check-input" id="isCompetition"> <label class="form-check-label" for="isCompetition">Competition</label> </div> <div class="mb-3"> <label for="zoneInput" class="form-label">Zone</label> <select id="zoneInput" class="form-select" disabled> <option value="" selected>Select a zone</option> <option value="A">A</option> <option value="B">B</option> <option value="C">C</option> <option value="D">D</option> </select> </div> <div class="mb-3"> <label for="pegInput" class="form-label">Peg</label> <select id="pegInput" class="form-select" disabled> <option value="" selected>Select a peg</option> <option value="1">1</option> <option value="2">2</option> <option value="3">3</option> <option value="4">4</option> <option value="5">5</option> <option value="6">6</option> <option value="7">7</option> <option value="8">8</option> </select> </div> <button class="btn btn-primary" id="startRecordingBtn">Record Catch</button> </div>

        <!-- Fishing Page -->
        <div id="fishingPage" class="card-section page"> <h2>Record Your Catch</h2> <div class="mb-3"> <label for="speciesInput" class="form-label">Species</label> <select id="speciesInput" class="form-select"> <option value="" selected>Select a species</option> <option value="Other">Other (specify)</option> </select> <input type="text" id="customSpeciesInput" class="form-control mt-2" placeholder="Enter custom species" style="display: none;"> </div> <div class="mb-3"> <label for="lengthInput" class="form-label">Length (cm)</label> <input type="number" id="lengthInput" class="form-control" placeholder="Enter length" step="1"> </div> <button class="btn btn-primary mb-3" id="addFishBtn">Add Fish</button> <button class="btn btn-secondary mb-3" id="backFromFishingBtn">Back</button> <h2>Fish Log</h2> <table class="table"> <thead> <tr> <th>Species</th> <th>Length (cm)</th> <th>Action</th> </tr> </thead> <tbody id="fishLog"></tbody> </table> <button class="btn btn-primary" id="endSessionBtn">End Session</button> </div>

        <!-- End Session Modal -->
        <div class="modal fade" id="endSessionModal" tabindex="-1" aria-labelledby="endSessionModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header"> <h5 class="modal-title" id="endSessionModalLabel">Confirm End Session</h5> <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> </div>
                    <div class="modal-body"> Are you sure you want to end your session? This will save the scorecard. </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="cancelEndSessionBtn">Return To Scorecard</button>
                        <button type="button" class="btn btn-danger" id="confirmEndBtn">Confirm & Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tally Page -->
        <div id="tallyPage" class="card-section page"> <h2>Catch Summary</h2> <div class="catch-summary-details"> <strong>Angler:</strong> <span id="summaryAngler"></span><br> <strong>Date:</strong> <span id="summaryDate"></span><br> <strong>Venue:</strong> <span id="summaryVenue"></span><br> <strong>Zone:</strong> <span id="summaryZone"></span><br> <strong>Peg:</strong> <span id="summaryPeg"></span><br> </div> <table class="table"> <thead> <tr> <th>Species</th> <th>Total Caught</th> <th>Lengths (cm)</th> <th>Total Length (cm)</th> </tr> </thead> <tbody id="tallyTable"></tbody> <tfoot> <tr> <td><strong>Total Length</strong></td> <td></td> <td></td> <td><strong id="tallyTotalLength">0 cm</strong></td> </tr> <tr> <td><strong>Species Count</strong></td> <td><strong id="tallySpeciesCount">0</strong></td> <td></td> <td></td> </tr> <tr> <td><strong>Longest Fish</strong></td> <td><strong id="longestFishSpecies">N/A</strong></td> <td><strong id="longestFishLength">0 cm</strong></td> <td></td> </tr> </tfoot> </table>
            <button class="btn btn-secondary mb-3" id="backFromTallyBtn">Back</button>
             <!-- Save Button Removed -->
        </div>

    </div>

    <script>
        const fishCategories = { "Flatfish": ["Brill", "Dab", "Flounder", "Halibut", "Megrim", "Plaice", "Sole (Dover)", "Sole (Lemon)", "Sole (Thickback)", "Turbot"], "Round Fish": ["Bass", "Bream (Black)", "Bream (Gilthead)", "Bream (Red)", "Bream (Sea)", "Coalfish", "Cod", "Conger Eel", "Gurnard (Red)", "Gurnard (Tub)", "Haddock", "Hake", "John Dory", "Ling", "Mackerel", "Monkfish", "Mullet (Grey)", "Mullet (Red)", "Pollack", "Poor Cod", "Pouting", "Saithe", "Salmon", "Shark (Blue)", "Shark (Porbeagle)", "Shark (Thresher)", "Smoothhound", "Sprat", "Tope", "Triggerfish", "Whiting"], "Rays and Skates": ["Ray (Blonde)", "Ray (Small-eyed)", "Ray (Starry)", "Ray (Thornback)", "Skate"], "Wrasse": ["Wrasse (Ballan)", "Wrasse (Cuckoo)"] };
        let fishData = []; let currentAngler = null; let currentDate = null; let currentVenue = null; let currentZone = null; let currentPeg = null; let currentPage = 'splashScreen'; let showingAllScorecards = false; // Flag not currently used but kept for potential future use

        function formatDate(dateString) { if (!dateString) return 'N/A'; try { const dateParts = dateString.split('-'); if (dateParts.length === 3) { const date = new Date(Date.UTC(parseInt(dateParts[0]), parseInt(dateParts[1]) - 1, parseInt(dateParts[2]))); return date.toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric', timeZone: 'UTC' }); } return new Date(dateString).toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' }); } catch (e) { console.error("Error formatting date:", dateString, e); return dateString; } }
        function showPage(pageId) { document.querySelectorAll('.page').forEach(page => page.style.display = 'none'); const targetPage = document.getElementById(pageId); if (targetPage) { targetPage.style.display = pageId === 'splashScreen' ? 'flex' : 'block'; currentPage = pageId; saveTempSession(); } else { console.error("Attempted to show non-existent page:", pageId); showPage('splashScreen'); } }
        function saveTempSession() { if (!currentAngler && !currentDate && !currentVenue && (!fishData || fishData.length === 0) && currentPage === 'registrationPage') { return; } const tempSession = { fishData: fishData || [], currentAngler, currentDate, currentVenue, currentZone, currentPeg, currentPage }; try { localStorage.setItem('temp_session', JSON.stringify(tempSession)); } catch (e) { console.error("Error saving temp session to localStorage:", e); } }
        function clearTempSession() { localStorage.removeItem('temp_session'); }
        function checkRestoreSession() { let data; try { const tempSession = localStorage.getItem('temp_session'); if (!tempSession) { showPage('splashScreen'); return; } data = JSON.parse(tempSession); if (!data || typeof data !== 'object' || !Array.isArray(data.fishData)) { throw new Error("Invalid or corrupted session data found."); } } catch (e) { console.error("Error reading or validating temp session:", e); clearTempSession(); showPage('splashScreen'); return; } if (data.currentAngler || data.currentDate || data.currentVenue || data.fishData.length > 0) { document.getElementById('restoreAngler').textContent = data.currentAngler || 'N/A'; document.getElementById('restoreDate').textContent = data.currentDate ? formatDate(data.currentDate) : 'N/A'; document.getElementById('restoreFishCount').textContent = data.fishData.length; const modalElement = document.getElementById('restoreSessionModal'); if (modalElement) { const modal = new bootstrap.Modal(modalElement, { backdrop: 'static', keyboard: false }); modal.show(); } else { console.error("Restore session modal not found."); showPage('splashScreen'); } } else { clearTempSession(); showPage('splashScreen'); } }
        function restoreSession() { let tempSession; try { const sessionString = localStorage.getItem('temp_session'); if (!sessionString) throw new Error("No session data found during restore attempt."); tempSession = JSON.parse(sessionString); if (!tempSession || typeof tempSession !== 'object' || !Array.isArray(tempSession.fishData)) { throw new Error("Invalid or corrupted session data during restore."); } } catch (e) { console.error("Error restoring session:", e); alert("Failed to restore session data. Starting new session."); startNewSession(); return; } fishData = tempSession.fishData; currentAngler = tempSession.currentAngler || null; currentDate = tempSession.currentDate || null; currentVenue = tempSession.currentVenue || null; currentZone = tempSession.currentZone || null; currentPeg = tempSession.currentPeg || null; const restoredPage = tempSession.currentPage || 'registrationPage'; if (currentAngler) document.getElementById('anglerName').value = currentAngler; if (currentDate) document.getElementById('competitionDate').value = currentDate; if (currentVenue) document.getElementById('venueInput').value = currentVenue; const isCompetition = !!(currentZone || currentPeg); document.getElementById('isCompetition').checked = isCompetition; toggleCompetitionFields(); if (currentZone) document.getElementById('zoneInput').value = currentZone; if (currentPeg) document.getElementById('pegInput').value = currentPeg; if (restoredPage === 'fishingPage' || restoredPage === 'tallyPage') { populateSpeciesDropdown(); if (restoredPage === 'fishingPage') { updateFishLog(); } else if (restoredPage === 'tallyPage') { document.getElementById('summaryAngler').textContent = currentAngler || 'N/A'; document.getElementById('summaryDate').textContent = currentDate ? formatDate(currentDate) : 'N/A'; document.getElementById('summaryVenue').textContent = currentVenue || 'N/A'; document.getElementById('summaryZone').textContent = currentZone || 'N/A'; document.getElementById('summaryPeg').textContent = currentPeg || 'N/A'; populateTallyTable(); } } const modalElement = document.getElementById('restoreSessionModal'); if (modalElement) { const modal = bootstrap.Modal.getInstance(modalElement); if (modal) { modal.hide(); } else { modalElement.style.display = 'none'; } const backdrop = document.querySelector('.modal-backdrop'); if (backdrop) backdrop.remove(); } showPage(restoredPage); }
        function startNewSession() { clearTempSession(); resetApp(); const modalElement = document.getElementById('restoreSessionModal'); if (modalElement) { const modal = bootstrap.Modal.getInstance(modalElement); if (modal) modal.hide(); const backdrop = document.querySelector('.modal-backdrop'); if (backdrop) backdrop.remove(); } showPage('splashScreen'); }
        function populateSpeciesDropdown() { const speciesInput = document.getElementById('speciesInput'); speciesInput.innerHTML = '<option value="" selected disabled>Select a species</option><option value="Other">Other (specify)</option>'; Object.keys(fishCategories).forEach(category => { const optgroup = document.createElement('optgroup'); optgroup.label = category; fishCategories[category].forEach(species => { const option = document.createElement('option'); option.value = species; option.textContent = species; optgroup.appendChild(option); }); speciesInput.appendChild(optgroup); }); }
        function toggleCustomSpeciesInput() { const speciesInput = document.getElementById('speciesInput'); const customSpeciesInput = document.getElementById('customSpeciesInput'); customSpeciesInput.style.display = speciesInput.value === 'Other' ? 'block' : 'none'; if (speciesInput.value !== 'Other') { customSpeciesInput.value = ''; } }
        function toggleCompetitionFields() { const isCompetition = document.getElementById('isCompetition').checked; document.getElementById('zoneInput').disabled = !isCompetition; document.getElementById('pegInput').disabled = !isCompetition; /* Variables updated by listener */ }
        function startApp() { showPage('registrationPage'); }
        function startRecording() { const anglerName = document.getElementById('anglerName').value.trim(); const competitionDate = document.getElementById('competitionDate').value; const venueInput = document.getElementById('venueInput').value.trim(); if (!anglerName || !competitionDate || !venueInput) { alert("Please fill in Angler Name, Date, and Venue."); return; } const isCompetition = document.getElementById('isCompetition').checked; if (isCompetition && (!currentZone || !currentPeg)) { alert("Competition selected: Please select a Zone and Peg."); return; } if (!/^\d{4}-\d{2}-\d{2}$/.test(competitionDate)) { alert("Please enter a valid date (YYYY-MM-DD)."); return; } populateSpeciesDropdown(); updateFishLog(); showPage('fishingPage'); }
        function addFish() { const speciesInput = document.getElementById('speciesInput'); const customSpeciesInput = document.getElementById('customSpeciesInput'); const lengthInput = document.getElementById('lengthInput'); let species = speciesInput.value; const lengthValue = lengthInput.value.trim(); let length; if (!lengthValue) { alert("Please enter the fish length."); return; } length = Math.round(parseFloat(lengthValue)); if (species === 'Other') { species = customSpeciesInput.value.trim(); if (!species) { alert("Please enter the custom species name."); return; } if (!/^[a-zA-Z\s'-]+$/.test(species)) { alert("Please enter a valid species name."); return; } } else if (!species || species === "") { alert("Please select a species."); return; } if (isNaN(length) || length <= 0 || length > 500) { alert("Please enter a valid length between 1 and 500 cm."); return; } fishData.push({ species, length }); updateFishLog(); speciesInput.value = ''; customSpeciesInput.value = ''; lengthInput.value = ''; toggleCustomSpeciesInput(); saveTempSession(); }
        function updateFishLog() { const fishLog = document.getElementById('fishLog'); fishLog.innerHTML = fishData.map((fish, index) => `<tr><td>${fish.species || 'Unknown'}</td><td>${fish.length || '?'}</td><td><button class="btn btn-danger btn-sm" onclick="deleteFish(${index})">Delete</button></td></tr>`).join(''); }
        function deleteFish(index) { if (index >= 0 && index < fishData.length) { const speciesName = fishData[index].species || 'Unknown'; const fishLength = fishData[index].length || '?'; if (confirm(`Delete this entry: ${speciesName} (${fishLength} cm)?`)) { fishData.splice(index, 1); updateFishLog(); saveTempSession(); } } else { console.error("Invalid index for fish deletion:", index); } }
        function backFromFishing() { showPage('registrationPage'); }
        function showEndSessionModal() { const modalElement = document.getElementById('endSessionModal'); if (modalElement) { const modal = new bootstrap.Modal(modalElement, { backdrop: 'static', keyboard: false }); modal.show(); } else { console.error("End session modal not found."); } }
        // function continueFishing() { /* Removed */ }

        function confirmEndSession() { const modalElement = document.getElementById('endSessionModal'); if (modalElement) { const modal = bootstrap.Modal.getInstance(modalElement); if (modal) { modal.hide(); } else { modalElement.style.display = 'none'; } const backdrop = document.querySelector('.modal-backdrop'); if (backdrop) backdrop.remove(); } if (!currentAngler || !currentDate || !currentVenue) { alert("Cannot save session: Missing Angler Name, Date, or Venue information. Please go back and complete these details."); return; } const sessionData = { currentAngler, currentDate, currentVenue, currentZone, currentPeg, fishData: fishData || [] }; const scorecardId = `scorecard_${Date.now()}`; try { localStorage.setItem(scorecardId, JSON.stringify(sessionData)); alert("Scorecard saved successfully!"); clearTempSession(); resetApp(); showPage('splashScreen'); } catch (e) { console.error("Error saving scorecard to localStorage:", e); alert("Error: Failed to save scorecard. Local storage might be full or disabled."); } }
        function populateTallyTable() { const tallyTable = document.getElementById('tallyTable'); const summary = {}; let totalLength = 0; let longestFish = null; let fishCount = 0; fishData.forEach(fish => { const speciesKey = fish.species || "Unknown"; const length = fish.length || 0; summary[speciesKey] = summary[speciesKey] || { count: 0, totalLength: 0, lengths: [] }; summary[speciesKey].count++; summary[speciesKey].totalLength += length; summary[speciesKey].lengths.push(length); summary[speciesKey].lengths.sort((a, b) => a - b); totalLength += length; fishCount++; if (!longestFish || length > (longestFish.length || 0)) { longestFish = fish; } }); const sortedSpecies = Object.entries(summary).sort(([a], [b]) => a.localeCompare(b)); tallyTable.innerHTML = sortedSpecies.map(([species, data]) => `<tr><td>${species}</td><td>${data.count}</td><td>(${data.lengths.join(', ')})</td><td>${data.totalLength}</td></tr>`).join(''); if (sortedSpecies.length === 0) { tallyTable.innerHTML = '<tr><td colspan="4" class="text-center">No fish recorded.</td></tr>'; } document.getElementById('tallyTotalLength').textContent = `${totalLength} cm`; document.getElementById('tallySpeciesCount').textContent = Object.keys(summary).length; document.getElementById('longestFishSpecies').textContent = longestFish ? (longestFish.species || 'Unk') : 'N/A'; document.getElementById('longestFishLength').textContent = longestFish ? `${longestFish.length || '?'} cm` : '0 cm'; }
        function backFromTally() { showPage('fishingPage'); }

        function showScorecardsModal() { loadScorecards(); const modalElement = document.getElementById('savedScorecardsModal'); if (modalElement) { const modal = new bootstrap.Modal(modalElement, { backdrop: 'static', keyboard: false }); modal.show(); } else { console.error("Saved scorecards modal not found."); } }

        // **** UPDATED loadScorecards function (handles older grouping) ****
        function loadScorecards() {
            const savedScorecardsList = document.getElementById('savedScorecardsList');
            const olderScorecardsToggleContainer = document.getElementById('olderScorecardsToggleContainer');
            savedScorecardsList.innerHTML = ''; olderScorecardsToggleContainer.innerHTML = '';
            const scorecards = [];
            try { for (let i = 0; i < localStorage.length; i++) { const key = localStorage.key(i); if (key && key.startsWith('scorecard_')) { const dataString = localStorage.getItem(key); if (dataString) { try { const data = JSON.parse(dataString); if (data && typeof data === 'object' && data.currentAngler && data.currentDate) { const timestamp = parseInt(key.split('_')[1], 10); if (!isNaN(timestamp)) { scorecards.push({ key, data, timestamp }); } else { console.warn("Invalid key:", key); } } else { console.warn("Invalid format:", key); } } catch (e) { console.error("Parse error:", key, e); } } } } } catch (e) { console.error("localStorage error:", e); savedScorecardsList.innerHTML = '<p class="text-danger">Could not load scorecards.</p>'; return; }
            scorecards.sort((a, b) => b.timestamp - a.timestamp);
            if (scorecards.length === 0) { savedScorecardsList.innerHTML = '<p>No saved scorecards found.</p>'; return; }
            const displayLimit = 4;
            scorecards.slice(0, displayLimit).forEach(({ key, data }, index) => { const itemContainer = document.createElement('div'); if (index === 0) { itemContainer.classList.add('latest-scorecard'); } else { itemContainer.classList.add('mb-2'); } let cardTotalLength = 0, cardFishCount = 0, cardSpecies = new Set(), cardLongestFish = null; const fishForCard = data.fishData || []; fishForCard.forEach(fish => { const length = fish.length || 0; cardFishCount++; cardTotalLength += length; if (fish.species) { cardSpecies.add(fish.species); } if (!cardLongestFish || length > (cardLongestFish.length || 0)) { cardLongestFish = fish; } }); const cardSpeciesCount = cardSpecies.size; const longestFishStr = cardLongestFish ? `${cardLongestFish.species || 'Unk'} (${cardLongestFish.length || '?'} cm)` : 'N/A';
                itemContainer.innerHTML = `<div class="scorecard-item" onclick="toggleScorecardDetails('${key}', this)"><i class="bi bi-chevron-right me-2"></i><strong>${data.currentAngler || 'N/A'}</strong> - ${formatDate(data.currentDate || '')}<span class="text-muted ms-2">(${cardFishCount} fish, ${cardTotalLength} cm total)</span>${index === 0 ? '<span class="badge bg-info text-dark ms-2">Latest</span>' : ''}</div><div class="scorecard-details" id="details_${key}"><h6>Session Details</h6><p><strong>Venue:</strong> ${data.currentVenue || 'N/A'}</p>${data.currentZone ? `<p><strong>Zone:</strong> ${data.currentZone}</p>` : ''}${data.currentPeg ? `<p><strong>Peg:</strong> ${data.currentPeg}</p>` : ''}<hr><h6>Catch List (${cardFishCount} Fish)</h6>${fishForCard.length > 0 ? `<table class="table table-sm table-striped"><thead><tr><th>#</th><th>Species</th><th>Length (cm)</th></tr></thead><tbody>${fishForCard.map((fish, fishIndex) => `<tr><td>${fishIndex + 1}</td><td>${fish.species || '?'}</td><td>${fish.length || '?'}</td></tr>`).join('')}</tbody></table>` : '<p>No fish recorded.</p>'}${fishForCard.length > 0 ? `<hr><h6>Summary</h6><p><strong>Total Length:</strong> ${cardTotalLength} cm</p><p><strong>Unique Species:</strong> ${cardSpeciesCount}</p><p><strong>Longest Fish:</strong> ${longestFishStr}</p>` : ''}<hr><button class="btn btn-danger btn-sm mt-2" onclick="deleteScorecard('${key}', event)">Delete Scorecard</button></div>`;
                savedScorecardsList.appendChild(itemContainer);
            });
            if (scorecards.length > displayLimit) {
                const olderCount = scorecards.length - displayLimit; const showOlderBtn = document.createElement('button'); showOlderBtn.id = 'showOlderBtn'; showOlderBtn.classList.add('btn', 'btn-outline-secondary'); showOlderBtn.textContent = `View ${olderCount} Older Scorecard${olderCount > 1 ? 's' : ''}`;
                showOlderBtn.onclick = function() { const olderScorecards = scorecards.slice(displayLimit); olderScorecards.forEach(({ key, data }) => { const itemContainer = document.createElement('div'); itemContainer.classList.add('mb-2'); let cardTotalLength = 0, cardFishCount = 0, cardSpecies = new Set(), cardLongestFish = null; const fishForCard = data.fishData || []; fishForCard.forEach(fish => { const length = fish.length || 0; cardFishCount++; cardTotalLength += length; if (fish.species) { cardSpecies.add(fish.species); } if (!cardLongestFish || length > (cardLongestFish.length || 0)) { cardLongestFish = fish; } }); const cardSpeciesCount = cardSpecies.size; const longestFishStr = cardLongestFish ? `${cardLongestFish.species || 'Unk'} (${cardLongestFish.length || '?'} cm)` : 'N/A'; itemContainer.innerHTML = `<div class="scorecard-item" onclick="toggleScorecardDetails('${key}', this)"><i class="bi bi-chevron-right me-2"></i><strong>${data.currentAngler || 'N/A'}</strong> - ${formatDate(data.currentDate || '')}<span class="text-muted ms-2">(${cardFishCount} fish, ${cardTotalLength} cm total)</span></div><div class="scorecard-details" id="details_${key}"><h6>Session Details</h6><p><strong>Venue:</strong> ${data.currentVenue || 'N/A'}</p>${data.currentZone ? `<p><strong>Zone:</strong> ${data.currentZone}</p>` : ''}${data.currentPeg ? `<p><strong>Peg:</strong> ${data.currentPeg}</p>` : ''}<hr><h6>Catch List (${cardFishCount} Fish)</h6>${fishForCard.length > 0 ? `<table class="table table-sm table-striped"><thead><tr><th>#</th><th>Species</th><th>Length (cm)</th></tr></thead><tbody>${fishForCard.map((fish, fishIndex) => `<tr><td>${fishIndex + 1}</td><td>${fish.species || '?'}</td><td>${fish.length || '?'}</td></tr>`).join('')}</tbody></table>` : '<p>No fish recorded.</p>'}${fishForCard.length > 0 ? `<hr><h6>Summary</h6><p><strong>Total Length:</strong> ${cardTotalLength} cm</p><p><strong>Unique Species:</strong> ${cardSpeciesCount}</p><p><strong>Longest Fish:</strong> ${longestFishStr}</p>` : ''}<hr><button class="btn btn-danger btn-sm mt-2" onclick="deleteScorecard('${key}', event)">Delete Scorecard</button></div>`; savedScorecardsList.appendChild(itemContainer); }); olderScorecardsToggleContainer.innerHTML = ''; };
                olderScorecardsToggleContainer.appendChild(showOlderBtn);
            }
        }

        function toggleScorecardDetails(key, element) { const details = document.getElementById(`details_${key}`); const icon = element.querySelector('i.bi'); if (details) { const isVisible = details.style.display === 'block'; details.style.display = isVisible ? 'none' : 'block'; if(icon) { icon.classList.toggle('bi-chevron-right', isVisible); icon.classList.toggle('bi-chevron-down', !isVisible); } } }
        function deleteScorecard(key, event) { event.stopPropagation(); let scorecardName = `scorecard ${key}`; try { const dataString = localStorage.getItem(key); if(dataString) { const data = JSON.parse(dataString); scorecardName = `scorecard for ${data.currentAngler} on ${formatDate(data.currentDate)}`; } } catch(e) { /* Ignore */ } if (confirm(`Delete ${scorecardName}?`)) { try { localStorage.removeItem(key); loadScorecards(); } catch (e) { console.error("Error removing scorecard:", e); alert("Failed to delete."); } } }
        function showMoreScorecards() { /* Removed */ }
        function closeModal() { const modalElement = document.getElementById('savedScorecardsModal'); if (modalElement) { const modal = bootstrap.Modal.getInstance(modalElement); if (modal) modal.hide(); const backdrop = document.querySelector('.modal-backdrop'); if (backdrop) backdrop.remove(); } }
        function resetApp() { fishData = []; currentAngler = null; currentDate = null; currentVenue = null; currentZone = null; currentPeg = null; showingAllScorecards = false; document.getElementById('anglerName').value = ''; document.getElementById('competitionDate').value = ''; document.getElementById('venueInput').value = ''; document.getElementById('isCompetition').checked = false; document.getElementById('zoneInput').value = ''; document.getElementById('pegInput').value = ''; document.getElementById('zoneInput').disabled = true; document.getElementById('pegInput').disabled = true; document.getElementById('speciesInput').value = ''; document.getElementById('customSpeciesInput').value = ''; document.getElementById('customSpeciesInput').style.display = 'none'; document.getElementById('lengthInput').value = ''; document.getElementById('fishLog').innerHTML = ''; document.getElementById('summaryAngler').textContent = ''; document.getElementById('summaryDate').textContent = ''; document.getElementById('summaryVenue').textContent = ''; document.getElementById('summaryZone').textContent = ''; document.getElementById('summaryPeg').textContent = ''; document.getElementById('tallyTable').innerHTML = ''; document.getElementById('tallyTotalLength').textContent = '0 cm'; document.getElementById('tallySpeciesCount').textContent = '0'; document.getElementById('longestFishSpecies').textContent = 'N/A'; document.getElementById('longestFishLength').textContent = '0 cm'; currentPage = 'splashScreen'; }

        // --- Initialisation ---
        document.addEventListener('DOMContentLoaded', () => {
             checkRestoreSession();
             const anglerNameInput = document.getElementById('anglerName'); const competitionDateInput = document.getElementById('competitionDate'); const venueInput = document.getElementById('venueInput'); const zoneSelect = document.getElementById('zoneInput'); const pegSelect = document.getElementById('pegInput'); const competitionCheck = document.getElementById('isCompetition');
             if (anglerNameInput) { anglerNameInput.addEventListener('input', () => { currentAngler = anglerNameInput.value.trim(); saveTempSession(); }); }
             if (competitionDateInput) { competitionDateInput.addEventListener('change', () => { currentDate = competitionDateInput.value; saveTempSession(); }); }
             if (venueInput) { venueInput.addEventListener('input', () => { currentVenue = venueInput.value.trim(); saveTempSession(); }); }
             if (zoneSelect) { zoneSelect.addEventListener('change', () => { currentZone = competitionCheck.checked ? zoneSelect.value : null; saveTempSession(); }); }
             if (pegSelect) { pegSelect.addEventListener('change', () => { currentPeg = competitionCheck.checked ? pegSelect.value : null; saveTempSession(); }); }
             if (competitionCheck) { competitionCheck.addEventListener('change', () => { currentZone = competitionCheck.checked ? zoneSelect.value : null; currentPeg = competitionCheck.checked ? pegSelect.value : null; toggleCompetitionFields(); saveTempSession(); }); }
             document.getElementById('continueBtn').addEventListener('click', startApp);
             document.getElementById('viewScorecardsBtn').addEventListener('click', showScorecardsModal);
             document.getElementById('startRecordingBtn').addEventListener('click', startRecording);
             document.getElementById('isCompetition').addEventListener('change', toggleCompetitionFields);
             document.getElementById('speciesInput').addEventListener('change', toggleCustomSpeciesInput);
             document.getElementById('addFishBtn').addEventListener('click', addFish);
             document.getElementById('backFromFishingBtn').addEventListener('click', backFromFishing);
             document.getElementById('endSessionBtn').addEventListener('click', showEndSessionModal);
             // Removed listener for 'continueFishingBtn'
             document.getElementById('confirmEndBtn').addEventListener('click', confirmEndSession);
             document.getElementById('backFromTallyBtn').addEventListener('click', backFromTally);
             // Removed listener for 'saveSessionBtn'
             // Removed listener for 'showMoreBtn'
             document.getElementById('closeModalBtn').addEventListener('click', closeModal);
             document.getElementById('restoreSessionBtn').addEventListener('click', restoreSession);
             document.getElementById('startNewSessionBtn').addEventListener('click', startNewSession);
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
